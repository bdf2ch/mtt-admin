<div class="container-fluid pl-0 pr-0 pt-4">
  <div class="row mb-4 no-gutters">
    <div class="col-12">
      <div class="tabs-container">
        <div class="tabs-labels">
          <div class="tab-label" [ngClass]="{'active': selectedTabIndex === 1}" (click)="selectTab(1)">Общая оценка</div>
          <div class="tab-label" [ngClass]="{'active': selectedTabIndex === 2}" (click)="selectTab(2)">Сравнительная оценка</div>
          <div class="tab-label" [ngClass]="{'active': selectedTabIndex === 3}" (click)="selectTab(3)">Отзывы</div>
          <div class="tab-label" [ngClass]="{'active': selectedTabIndex === 4}" (click)="selectTab(4)">Экспорт</div>
        </div>

        <!-- Start: Filters -->
        <div class="filters border-bottom pb-4 pt-4">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12">
                <div el-row gutter="30">
                  <div el-col span="8">
                    <el-form [formGroup]="filterForm"
                             label-width="150px"
                             [label-position]="'left'"
                             size="small"
                             [show-icon]="true"
                             [show-message]="true">
                        <!-- Start: Start date -->
                        <el-form-item label="Начало периода"
                                      [required]="false"
                                      [status]="filterFormStatusCtrl('start')"
                                      [error]="filterFormMessageCtrl('start')">
                          <el-input formControlName="start" [(model)]="filterData.date_from"></el-input>
                        </el-form-item>
                        <!-- End: Start date -->

                        <!-- Start: Start date -->
                        <el-form-item label="Окончание периода"
                                      [required]="false"
                                      [status]="filterFormStatusCtrl('end')"
                                      [error]="filterFormMessageCtrl('end')">
                          <el-input formControlName="end" [(model)]="filterData.date_to"></el-input>
                        </el-form-item>
                        <!-- End: Start date -->
                    </el-form>
                  </div>
                  <div el-col span="10">
                    <el-checkbox
                      *ngFor="let restaurant of surveysService.selectedSurvey().restaurants"
                      [label]="restaurant.title" (modelChange)="changeRestaurant($event, restaurant)"></el-checkbox>
                    <!-- End: Start date -->
                  </div>
                </div>
                <div el-col span="8">
                  <el-button type="primary" icon="document" (click)="getReport()">&nbsp; Сформировать отчет</el-button>
                </div>

              </div>
            </div>
          </div>
        </div>
        <div class="tab" *ngIf="selectedTabIndex === 1">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12 border-bottom pt-4 pb-4">
                <div><h4>Общая оценка удовлетворенности клиентов</h4></div>
                <div class="d-flex flex-row flex-wrap">
                  <!--
                  <table class="table">
                    <tr *ngFor="let restaurant of surveysService.getCommonReport().restaurants">
                      <td>{{restaurant.title }}</td>
                      <td>{{ restaurant.stat.value }}</td>
                    </tr>
                  </table>
                  -->


                  <div class="mr-4" *ngFor="let restaurant of surveysService.getCommonReport().restaurants">
                    <span class="mr-2">{{ restaurant.title }}</span>
                    <el-tag [type]="restaurant.stat.value < 50 ? 'danger' : 'success'">{{ restaurant.stat.value }}</el-tag>
                  </div>
                </div>
              </div>
            </div>

            <div class="row pt-4" *ngFor="let question of surveysService.getCommonReport().questions; let i = index">
              <div class="col-12">
                <div *ngIf="question.form.type !== 'text_input'">{{ i + 1 }}. {{ question.title }}</div>

                <div class="p-4 text-muted" *ngIf="question.statTotal === 0">
                  Статистика отсутствует
                </div>

                <div *ngIf="question.form.type === 'radio_button' && question.statTotal > 0">
                  <ngx-charts-advanced-pie-chart
                    class="chart-container"
                    [scheme]="colorScheme"
                    [results]="question.stat"
                    (legendLabelClick)="onLegendLabelClick($event)"
                    [gradient]="gradient"
                    [tooltipDisabled]="tooltipDisabled"
                    (select)="select($event)">
                  </ngx-charts-advanced-pie-chart>
                </div>

                <div *ngIf="question.form.type === 'checkbox' && question.statTotal > 0">
                  <div>
                    <ngx-charts-pie-grid
                      class="chart-container"
                      [scheme]="colorScheme"
                      (legendLabelClick)="onLegendLabelClick($event)"
                      [results]="question.stat"
                      [tooltipDisabled]="tooltipDisabled"
                      (select)="select($event)">
                    </ngx-charts-pie-grid>
                  </div>
                </div>

                <div *ngIf="question.form.type === 'mark' && question.statTotal > 0">
                  <div>
                    <ngx-charts-pie-grid
                      class="chart-container"
                      [scheme]="colorScheme"
                      (legendLabelClick)="onLegendLabelClick($event)"
                      [results]="question.stat"
                      [tooltipDisabled]="tooltipDisabled"
                      (select)="select($event)">
                    </ngx-charts-pie-grid>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="tab p-4" *ngIf="selectedTabIndex === 2"></div>
        <div class="tab" *ngIf="selectedTabIndex === 3"></div>
        <div class="tab" *ngIf="selectedTabIndex === 4"></div>
      </div>
    </div>
  </div>
</div>
